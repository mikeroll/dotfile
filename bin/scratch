#!/usr/bin/zsh

# This should normally be in the bspwmrc:
# bspc rule -a scratchpad sticky=on state=floating layer=above hidden=on

s_width=1920
s_height=1080
w_width=634
w_height=222
w_x=$(( (s_width - w_width) / 2 ))
w_y=$(( s_height - w_height ))

function find_wid() {
    wmctrl -lpx | awk '$4 == "termite.scratchpad" { print $1 }'
}

function start() {
    termite --geometry ${w_width}x${w_height} --class scratchpad &!
}

function toggle() {
    wid=$(find_wid)
    if [[ -z $wid ]]; then
        start
        # Wait for window to initialize
        while [[ -z $wid ]]; do 
            sleep 0.01 && wid=$(find_wid)
        done
    fi

    # Reset original size and position just before showing up
    if [[ $(bspc query -T -n $wid | jq .hidden) == 'true' ]]; then
        xdotool windowsize $wid $w_width $w_height
        xdotool windowmove $wid $w_x $w_y
    fi
    bspc node $wid --flag hidden
    bspc node -f $wid
}

$1
